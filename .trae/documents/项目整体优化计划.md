# 项目整体优化计划

为了提升项目的稳定性、性能和用户体验，我将从后端代码质量、功能完善以及前端交互优化三个维度进行全面提升。

## 后端优化 (Go)

### 1. 代码质量与数据库严谨性
- **事务支持**: 为 `RepoService.Update` 等涉及多表操作的方法添加 GORM 事务支持，确保数据一致性。
- **数据库通用化**: 重构 `PushRepo` 中的 SQLite 特有函数（如 `datetime('now')`, `strftime`），改为通用的 GORM 表达式或在 Go 层处理时间，提升数据库迁移能力。
- **错误包装**: 优化错误处理机制，使用 `fmt.Errorf("...: %w", err)` 包装错误，保留原始错误堆栈。

### 2. 性能与并发优化
- **查询优化**: 为 `Repo` 模型添加 `WebhookID` 字段并建立唯一索引，将 `GetByWebhookID` 的模糊查询优化为精确匹配。
- **并发控制**: 引入有界 Worker Pool 替换 Webhook 处理中的无限制 `go` 协程，防止高并发场景下的资源耗尽。
- **AI 审查频率控制**: 优化代码审查队列，合理配置并发数，避免触发 AI 接口的速率限制。

### 3. 功能补全
- **提示词管理**: 实现 `PromptHandler` 中标记为 TODO 的版本回滚和测试逻辑。

## 前端优化 (Vue 3)

### 1. 数据可视化
- **仪表盘增强**: 利用已有的 `ECharts` 库，在首页增加推送成功率饼图和近 7 天推送量趋势图，直观展示系统运行状态。

### 2. 交互体验 (UX)
- **加载反馈**: 为“测试 Webhook”、“保存配置”等异步按钮添加 `loading` 状态，防止重复提交并提升反馈感。
- **表单校验**: 强化仓库配置、推送目标等表单的校验逻辑，提供更友好的错误提示。
- **日志筛选**: 优化日志列表的过滤交互，支持更多维度的快速筛选。

## 实施步骤
1. **第一阶段**: 后端模型调整、数据库迁移及核心 Service 的事务与并发重构。
2. **第二阶段**: 后端功能补全（提示词回滚等）与 Repository 优化。
3. **第三阶段**: 前端仪表盘图表集成与全局交互细节（Loading、校验）提升。

您是否同意按照此计划开始执行？如果您有任何特定优先级的调整，请告诉我。